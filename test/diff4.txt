testdiff --git a/TMessagesProj/jni/image.c b/TMessagesProj/jni/image.c
index 5aa93f9..b3e4517 100644
--- a/TMessagesProj/jni/image.c
+++ b/TMessagesProj/jni/image.c
@@ -59,7 +59,7 @@
 }
 
 static inline uint64_t getColors(const uint8_t *p) {
-    return p[0] + (p[1] << 16) + ((uint64_t) p[2] << 32);
+    return p[0] + (p[1] << 16) + ((uint64_t) p[2] << 32) + ((uint64_t) p[3] << 48);
 }
 
 static inline uint64_t getColors565(const uint8_t *p) {
@@ -134,6 +134,7 @@
             pix[yi] = res;              \
             pix[yi + 1] = res >> 16;    \
             pix[yi + 2] = res >> 32;    \
+            pix[yi + 3] = res >> 48;    \
             rgballsum += rgb[x + (start) * w] - 2 * rgb[x + (middle) * w] + rgb[x + (end) * w]; \
             rgbsum += rgballsum; \
             y++; \
@@ -235,6 +236,7 @@
                 pix[yi] = res;              \
                 pix[yi + 1] = res >> 16;    \
                 pix[yi + 2] = res >> 32;    \
+                pix[yi + 3] = res >> 48;    \
                 rgballsum += rgb[x + (start) * w] - 2 * rgb[x + (middle) * w] + rgb[x + (end) * w]; \
                 rgbsum += rgballsum;        \
                 y++;                        \
