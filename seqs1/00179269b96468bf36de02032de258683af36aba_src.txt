@ ApiOperation ( value = "Finds a client by client id" ) @ ApiResponses ( value = { @ ApiResponse ( code = 200 , message = "Client returned successfully" ) , @ ApiResponse ( code = 404 , message = "Client couldn't be found" ) , @ ApiResponse ( code = 500 , message = "Internal server error" ) } ) @ RequestMapping ( value = { "/{clientId:\\d+}" } , method = RequestMethod . GET ) public Client getClientById ( @ ApiParam ( name = "clientId" , value = "Client id" ) @ PathVariable ( ) Long clientId )  
Client result = clientService . findClientById ( clientId )  
@ ApiOperation ( value = "Deletes a client given an id" ) @ ApiResponses ( value = { @ ApiResponse ( code = 204 , message = "Client successfully deleted" ) , @ ApiResponse ( code = 404 , message = "Client can't be found by id" ) , @ ApiResponse ( code = 500 , message = "Internal server error" ) } ) @ RequestMapping ( value = { "/{clientId:\\d+}" } , method = RequestMethod . DELETE ) @ ResponseStatus ( HttpStatus . NO_CONTENT ) public void deleteCliet ( @ ApiParam ( name = "clientId" , value = "Client id" ) @ PathVariable ( ) Long clientId )  
clientService . deleteClient ( clientId )  
public Client findClientById ( Long clientId )  
public void deleteClient ( Long clientId )  
clientRepository . delete ( clientId )  
Order result = orderConverter . repositoryToApiModel ( newOrder )  
ProductEntity product  
for ( OrderDetail detail : details )  
product = productRepository . findOne ( detail . getProductId ( ) )  
if ( product == null || ! product . getStore ( ) . getId ( ) . equals ( storeId ) )  
result . getErrors ( ) . add ( detail )  
Optional < StockEntity > resultStock = stockRepository . findByProduct ( product )  
resultStock . isPresent ( ) ? 0 : resultStock . get ( ) . getExistence ( )  
existence = resultStock . isPresent ( ) ? 0 : resultStock . get ( ) . getExistence ( )  
: resultStock . get ( ) . getExistence ( )  
createOrderDetail ( result , detail , newOrder , product , OrderDetailStatusEnum . ORDERED )  
createOrderDetail ( result , detailOrdered , newOrder , product , OrderDetailStatusEnum . ORDERED )  
createOrderDetail ( result , detailBackordered , newOrder , product , OrderDetailStatusEnum . BACKORDERED )  
createOrderDetail ( result , detail , newOrder , product , OrderDetailStatusEnum . BACKORDERED )  
OrderDetailEntity detailEntity = new OrderDetailEntity ( orderEntity , productEntity , status , detail . getCount ( ) )  
@ Test public void createOrderNotFound ( ) throws IOException  
ResponseEntity < String > response = getJSONResponse ( template , String . format ( REQUEST_URI , basePath ( ) ) + "99" , FileUtils . readFileToString ( newStockRequest ) , HttpMethod . POST )  
assertEquals ( "Store not found" , HttpStatus . NOT_FOUND , response . getStatusCode ( ) )  
@ Test @ FlywayTest public void createOrderClientInvalid ( ) throws IOException  
ResourceCreated responseStoreId = mapper . readValue ( responseStore . getBody ( ) , ResourceCreated . class )  
ResponseEntity < String > responseProduct = getJSONResponse ( template , String . format ( TestProductController . REQUEST_URI , basePath ( ) ) + responseStoreId . getId ( ) , FileUtils . readFileToString ( newProductRequest ) , HttpMethod . POST )  
assertEquals ( "Product created" , HttpStatus . CREATED , responseProduct . getStatusCode ( ) )  
ResourceCreated responseProductId = mapper . readValue ( responseProduct . getBody ( ) , ResourceCreated . class )  
ResponseEntity < String > responseStock = getJSONResponse ( template , String . format ( TestStockController . REQUEST_URI , basePath ( ) ) + responseStoreId . getId ( ) + "/" + responseProductId . getId ( ) , FileUtils . readFileToString ( newStockRequest ) , HttpMethod . POST )  
ResponseEntity < String > response = getJSONResponse ( template , String . format ( REQUEST_URI , basePath ( ) ) + responseStoreId . getId ( ) , FileUtils . readFileToString ( newOrderClientInvalidRequest ) , HttpMethod . POST )  
assertEquals ( "Order not created, client not found" , HttpStatus . NOT_FOUND , response . getStatusCode ( ) )  
ResponseEntity < String > responseProduct = getJSONResponse ( template , String . format ( TestProductController . REQUEST_URI , basePath ( ) ) + responseStoreId . getId ( ) , FileUtils . readFileToString ( newProductRequest ) , HttpMethod . POST )  
assertEquals ( "Product created" , HttpStatus . CREATED , responseProduct . getStatusCode ( ) )  
ResourceCreated responseProductId = mapper . readValue ( responseProduct . getBody ( ) , ResourceCreated . class )  
ResponseEntity < String > responseStock = getJSONResponse ( template , String . format ( TestStockController . REQUEST_URI , basePath ( ) ) + responseStoreId . getId ( ) + "/" + responseProductId . getId ( ) , FileUtils . readFileToString ( newStockRequest ) , HttpMethod . POST )  
assertEquals ( "Stock created" , HttpStatus . OK , responseStock . getStatusCode ( ) )  
ResponseEntity < String > responseClient = getJSONResponse ( template , String . format ( TestClientController . REQUEST_URI , basePath ( ) ) , FileUtils . readFileToString ( newClientRequest ) , HttpMethod . POST )  
ResponseEntity < String > response = getJSONResponse ( template , String . format ( REQUEST_URI , basePath ( ) ) + responseStoreId . getId ( ) , FileUtils . readFileToString ( newOrderRequest ) , HttpMethod . POST )  
Order orderResponse = mapper . readValue ( response . getBody ( ) , Order . class )  
assertEquals ( "Order created correct store id" , orderResponse . getStoreId ( ) . intValue ( ) , responseStoreId . getId ( ) )  
assertEquals ( "Order created correct client last name" , orderResponse . getClient ( ) . getLastName ( ) , "Roger" )  
assertEquals ( "Order created correct client email" , orderResponse . getClient ( ) . getEmail ( ) , "client@domian.co" )  
assertEquals ( "Order created correct client phone" , orderResponse . getClient ( ) . getPhone ( ) , "5512345678" )  
ResponseEntity < String > responseProduct = getJSONResponse ( template , String . format ( TestProductController . REQUEST_URI , basePath ( ) ) + responseStoreId . getId ( ) , FileUtils . readFileToString ( newProductRequest ) , HttpMethod . POST )  
ResponseEntity < String > responseStock = getJSONResponse ( template , String . format ( TestStockController . REQUEST_URI , basePath ( ) ) + responseStoreId . getId ( ) + "/" + responseProductId . getId ( ) , FileUtils . readFileToString ( newStockRequest ) , HttpMethod . POST )  
assertEquals ( "Stock created" , HttpStatus . OK , responseStock . getStatusCode ( ) )  
ResourceCreated responseClientId = mapper . readValue ( responseClient . getBody ( ) , ResourceCreated . class )  
Order orderResponse = mapper . readValue ( response . getBody ( ) , Order . class )  
assertEquals ( "Order created correct store id" , orderResponse . getStoreId ( ) . intValue ( ) , responseStoreId . getId ( ) )  
assertEquals ( "Order created correct product count" , orderResponse . getProducts ( ) . get ( 0 ) . getCount ( ) , Long . valueOf ( 10 ) )  
ResponseEntity < String > responseGet = getJSONResponse ( template , String . format ( TestStockController . REQUEST_URI , basePath ( ) ) + responseStoreId . getId ( ) + "/" + responseProductId . getId ( ) , null , HttpMethod . GET )  
ResourceCreated responseStoreId = mapper . readValue ( responseStore . getBody ( ) , ResourceCreated . class )  
assertEquals ( "Product created" , HttpStatus . CREATED , responseProduct . getStatusCode ( ) )  
ResponseEntity < String > responseStock = getJSONResponse ( template , String . format ( TestStockController . REQUEST_URI , basePath ( ) ) + responseStoreId . getId ( ) + "/" + responseProductId . getId ( ) , FileUtils . readFileToString ( newStockRequest ) , HttpMethod . POST )  
assertEquals ( "Stock created" , HttpStatus . OK , responseStock . getStatusCode ( ) )  
ResponseEntity < String > responseClient = getJSONResponse ( template , String . format ( TestClientController . REQUEST_URI , basePath ( ) ) , FileUtils . readFileToString ( newClientRequest ) , HttpMethod . POST )  
assertEquals ( "Client created" , HttpStatus . CREATED , responseClient . getStatusCode ( ) )  
ResponseEntity < String > response = getJSONResponse ( template , String . format ( REQUEST_URI , basePath ( ) ) + responseStoreId . getId ( ) , FileUtils . readFileToString ( newOrderBackorderRequest ) , HttpMethod . POST )  
assertEquals ( "Order created correct order id" , orderResponse . getOrderId ( ) , Long . valueOf ( 1 ) )  
assertEquals ( "Order created correct store id" , orderResponse . getStoreId ( ) . intValue ( ) , responseStoreId . getId ( ) )  
ResponseEntity < String > responseGet = getJSONResponse ( template , String . format ( TestStockController . REQUEST_URI , basePath ( ) ) + responseStoreId . getId ( ) + "/" + responseProductId . getId ( ) , null , HttpMethod . GET )  
Stock responseGetBody = mapper . readValue ( responseGet . getBody ( ) , Stock . class )  
ResponseEntity < String > responseStock = getJSONResponse ( template , String . format ( TestStockController . REQUEST_URI , basePath ( ) ) + responseStoreId . getId ( ) + "/" + responseProductId . getId ( ) , FileUtils . readFileToString ( newStockRequest ) , HttpMethod . POST )  
ResponseEntity < String > response = getJSONResponse ( template , String . format ( REQUEST_URI , basePath ( ) ) + responseStoreId . getId ( ) , FileUtils . readFileToString ( newOrderErrorsRequest ) , HttpMethod . POST )  
assertEquals ( "Order created correct store id" , orderResponse . getStoreId ( ) . intValue ( ) , responseStoreId . getId ( ) )  
ResponseEntity < String > responseGet = getJSONResponse ( template , String . format ( TestStockController . REQUEST_URI , basePath ( ) ) + responseStoreId . getId ( ) + "/" + responseProductId . getId ( ) , null , HttpMethod . GET )  
assertEquals ( "Stock get OK correct count" , responseGetBody . getCount ( ) , Long . valueOf ( 25 ) )  
ResponseEntity < String > responseStock = getJSONResponse ( template , String . format ( TestStockController . REQUEST_URI , basePath ( ) ) + responseStoreId . getId ( ) + "/" + responseProductId . getId ( ) , FileUtils . readFileToString ( newStockRequest ) , HttpMethod . POST )  
ResponseEntity < String > response = getJSONResponse ( template , String . format ( REQUEST_URI , basePath ( ) ) + responseStoreId . getId ( ) , FileUtils . readFileToString ( newOrderDetailNullRequest ) , HttpMethod . POST )  
ResponseEntity < String > responseStock = getJSONResponse ( template , String . format ( TestStockController . REQUEST_URI , basePath ( ) ) + responseStoreId . getId ( ) + "/" + responseProductId . getId ( ) , FileUtils . readFileToString ( newStockRequest ) , HttpMethod . POST )  
ResponseEntity < String > response = getJSONResponse ( template , String . format ( REQUEST_URI , basePath ( ) ) + responseStoreId . getId ( ) , FileUtils . readFileToString ( newOrderProductIdNullRequest ) , HttpMethod . POST )  
@ Test public void updateStockNotFound ( ) throws IOException  
ResponseEntity < String > response = getJSONResponse ( template , String . format ( REQUEST_URI , basePath ( ) ) + "99/99" , FileUtils . readFileToString ( newStockRequest ) , HttpMethod . POST )  
assertEquals ( "Store or product not found" , HttpStatus . NOT_FOUND , response . getStatusCode ( ) )  
@ Test @ FlywayTest public void createAndGetStockOk ( ) throws IOException  
ResponseEntity < String > response = getJSONResponse ( template , String . format ( REQUEST_URI , basePath ( ) ) + responseStoreId . getId ( ) + "/" + responseProductId . getId ( ) , FileUtils . readFileToString ( newStockRequest ) , HttpMethod . POST )  
assertEquals ( "Stock created" , HttpStatus . OK , response . getStatusCode ( ) )  
ResponseEntity < String > responseGet = getJSONResponse ( template , String . format ( REQUEST_URI , basePath ( ) ) + responseStoreId . getId ( ) + "/" + responseProductId . getId ( ) , null , HttpMethod . GET )  
assertEquals ( "Stock get OK" , HttpStatus . OK , responseGet . getStatusCode ( ) )  
Stock responseGetBody = mapper . readValue ( responseGet . getBody ( ) , Stock . class )  
assertEquals ( "Stock get OK correct count" , responseGetBody . getCount ( ) , Long . valueOf ( 50 ) )  
@ Test @ FlywayTest public void getEmptyStockOk ( ) throws IOException  
ResponseEntity < String > responseGet = getJSONResponse ( template , String . format ( REQUEST_URI , basePath ( ) ) + responseStoreId . getId ( ) + "/" + responseProductId . getId ( ) , null , HttpMethod . GET )  
assertEquals ( "Stock get OK" , HttpStatus . OK , responseGet . getStatusCode ( ) )  
Stock responseGetBody = mapper . readValue ( responseGet . getBody ( ) , Stock . class )  
assertEquals ( "Stock get OK correct count" , responseGetBody . getCount ( ) , Long . valueOf ( 0 ) )  
ResponseEntity < String > responseGet = getJSONResponse ( template , String . format ( REQUEST_URI , basePath ( ) ) + "9/9" , null , HttpMethod . GET )  
assertEquals ( "Stock get not found" , HttpStatus . NOT_FOUND , responseGet . getStatusCode ( ) )  
@ Test @ FlywayTest public void getStockProductNotFound ( ) throws IOException  
ResponseEntity < String > responseGet = getJSONResponse ( template , String . format ( REQUEST_URI , basePath ( ) ) + responseStoreId . getId ( ) + "/9" , null , HttpMethod . GET )  
assertEquals ( "Stock get product not found" , HttpStatus . NOT_FOUND , responseGet . getStatusCode ( ) )  
@ Test @ FlywayTest public void getStockProductWrongStoreNotFound ( ) throws IOException  
ResponseEntity < String > responseGet = getJSONResponse ( template , String . format ( REQUEST_URI , basePath ( ) ) + "9/" + responseProductId . getId ( ) , null , HttpMethod . GET )  
assertEquals ( "Stock get wrong store" , HttpStatus . NOT_FOUND , responseGet . getStatusCode ( ) )  
@ Test @ FlywayTest public void createStockProductNotFound ( ) throws IOException  
ResponseEntity < String > response = getJSONResponse ( template , String . format ( REQUEST_URI , basePath ( ) ) + responseStoreId . getId ( ) + "/5" , FileUtils . readFileToString ( newStockRequest ) , HttpMethod . POST )  
assertEquals ( "Stock not created, product not found" , HttpStatus . NOT_FOUND , response . getStatusCode ( ) )  
@ Test @ FlywayTest public void createStockCountNull ( ) throws IOException  
assertEquals ( "Stock not created, stock count null" , HttpStatus . PRECONDITION_FAILED , response . getStatusCode ( ) )  
ResponseEntity < String > responseGetUpdate = getJSONResponse ( template , String . format ( REQUEST_URI , basePath ( ) ) + responseStoreId . getId ( ) + "/" + responseProductId . getId ( ) , null , HttpMethod . GET )  
@ Test @ FlywayTest public void createStockInvalidCount ( ) throws IOException  
ResponseEntity < String > response = getJSONResponse ( template , String . format ( REQUEST_URI , basePath ( ) ) + responseStoreId . getId ( ) + "/" + responseProductId . getId ( ) , "{\"count\": \"FIFTY\"}" , HttpMethod . POST )  
assertEquals ( "Stock not created bad request" , HttpStatus . BAD_REQUEST , response . getStatusCode ( ) )  
